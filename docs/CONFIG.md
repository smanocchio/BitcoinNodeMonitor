# Configuration Reference

All configuration is managed via the `.env` file (copied from `.env.example`). Docker Compose passes these variables to the services at runtime.

## Bitcoin Core setup (important)
The collector pulls metrics from Bitcoin Core via RPC (and optionally ZMQ).
You do not point Bitcoin Core to a Prometheus or collector endpoint.

Minimal bitcoin.conf:

ini
Copy code
server=1
rpcbind=127.0.0.1
# If remote collector, allow your LAN and/or create a read-only RPC user:
# rpcallowip=192.168.0.0/16

# Optional (recommended):
zmqpubrawblock=tcp://127.0.0.1:28332
zmqpubrawtx=tcp://127.0.0.1:28333
Set matching envs in .env:

pgsql
Copy code
BITCOIN_RPC_HOST/PORT, BITCOIN_RPC_COOKIE_PATH (or USER/PASSWORD)
BITCOIN_ZMQ_RAWBLOCK, BITCOIN_ZMQ_RAWTX  (if you enabled ZMQ)

## Bitcoin Core

| Variable | Description | Default |
|----------|-------------|---------|
| `BITCOIN_RPC_HOST` | Hostname or IP for Bitcoin Core RPC interface. | `127.0.0.1` |
| `BITCOIN_RPC_PORT` | RPC port. | `8332` |
| `BITCOIN_RPC_USER` | RPC username (leave blank for cookie auth). | _empty_ |
| `BITCOIN_RPC_PASSWORD` | RPC password (leave blank for cookie auth). | _empty_ |
| `BITCOIN_RPC_COOKIE_PATH` | Path to `.cookie` file; autodetected if left at default and local. | `~/.bitcoin/.cookie` |
| `BITCOIN_NETWORK` | Network name (`mainnet`, `testnet`, `signet`, `regtest`). Controls labels and retention defaults. | `mainnet` |
| `BITCOIN_DATADIR` | Mount path for Bitcoin data directory (read-only). Used for process metrics and disk stats. | `~/.bitcoin` |
| `BITCOIN_CHAINSTATE_DIR` | Path to the `chainstate` directory (for disk usage). | `~/.bitcoin/chainstate` |

## ZMQ Streams

| Variable | Description | Default |
|----------|-------------|---------|
| `BITCOIN_ZMQ_RAWBLOCK` | ZMQ endpoint for raw block messages. | `tcp://127.0.0.1:28332` |
| `BITCOIN_ZMQ_RAWTX` | ZMQ endpoint for raw transaction messages. | `tcp://127.0.0.1:28333` |

## Optional Fulcrum/Electrs

| Variable | Description | Default |
|----------|-------------|---------|
| `FULCRUM_STATS_URL` | HTTP stats endpoint (Fulcrum `/stats` or Electrs JSON). Leave blank to disable. | `http://127.0.0.1:8080/stats` |

## InfluxDB

| Variable | Description | Default |
|----------|-------------|---------|
| `USE_EXTERNAL_INFLUX` | `0` to run bundled InfluxDB, `1` to use an existing instance. | `0` |
| `INFLUX_URL` | URL used by the collector to write data. Matches docker-compose service name in bundled mode. | `http://influxdb:8086` |
| `INFLUX_ORG` | InfluxDB organization name created during bootstrap. | `bitcoin` |
| `INFLUX_BUCKET` | Bucket where metrics are stored. | `btc_metrics` |
| `INFLUX_RETENTION_DAYS` | Retention period for metrics (used during bootstrap). | `60` |
| `INFLUX_SETUP_USERNAME` | Admin username created on first run. | `admin` |
| `INFLUX_SETUP_PASSWORD` | Admin password created on first run. Change after setup. | `admin123` |
| `INFLUX_TOKEN` | API token for collector writes. Generated by `influx/init.sh` if left blank. Required for external InfluxDB. | _empty_ |

## Grafana

| Variable | Description | Default |
|----------|-------------|---------|
| `USE_EXTERNAL_GRAFANA` | `0` to run bundled Grafana, `1` to use your own Grafana instance. | `0` |
| `GRAFANA_ADMIN_USER` | Initial Grafana admin username. | `admin` |
| `GRAFANA_ADMIN_PASSWORD` | Initial Grafana admin password. | `admin` |
| `EXPOSE_UI` | `0` keeps Grafana/Influx bound to localhost; set to `1` to listen on all interfaces. Pair with firewall/proxy. | `0` |
| `GRAFANA_BIND_IP` | Optional override for Grafana bind IP (`127.0.0.1` or `0.0.0.0`). Auto-set by entrypoint when `EXPOSE_UI` is changed. | _auto_ |
| `INFLUX_BIND_IP` | Optional override for Influx bind IP. | _auto_ |

## Feature Flags

Toggle collection modules on/off (use `0` or `1`).

| Variable | Description | Default |
|----------|-------------|---------|
| `ENABLE_BLOCK_INTERVALS` | Compute rolling block interval statistics. | `1` |
| `ENABLE_SOFTFORK_SIGNAL` | Collect BIP9 soft-fork signalling metrics. | `1` |
| `ENABLE_PEER_QUALITY` | Gather peer version, ping, and geo metrics. | `1` |
| `ENABLE_PROCESS_METRICS` | Include CPU, RAM, open file descriptors. | `1` |
| `ENABLE_DISK_IO` | Sample disk IO throughput via `psutil`. | `1` |
| `ENABLE_PEER_CHURN` | Track joins/leaves per minute. | `1` |
| `ENABLE_ASN_STATS` | Resolve ASN/ISP counts using GeoIP ASN database. | `1` |

## Mempool Histogram

| Variable | Description | Default |
|----------|-------------|---------|
| `MEMPOOL_HIST_SOURCE` | `none`, `core_rawmempool`, or `mempool_api`. | `none` |
| `MEMPOOL_API_BASE` | Base URL for mempool.space API clone when using `mempool_api`. | `http://127.0.0.1:3006` |

## Collector Polling

| Variable | Description | Default |
|----------|-------------|---------|
| `SCRAPE_INTERVAL_FAST` | Interval (seconds) for fast loop (block height, mempool). | `5` |
| `SCRAPE_INTERVAL_SLOW` | Interval (seconds) for slower metrics (disk usage, peers). | `30` |

## GeoIP

| Variable | Description | Default |
|----------|-------------|---------|
| `GEOIP_ACCOUNT_ID` | MaxMind account ID. Required for downloads. | _empty_ |
| `GEOIP_LICENSE_KEY` | MaxMind license key. Required for downloads. | _empty_ |
| `GEOIP_UPDATE_FREQUENCY_DAYS` | How often to refresh databases. | `7` |

## Advanced Overrides

These rarely need changes:

- `COLLECTOR_LOG_LEVEL` (default `INFO`) controls log verbosity.
- `COLLECTOR_HEALTHCHECK_TIMEOUT` (default `15`) used by healthcheck CLI.
- `INFLUX_SETUP_RETENTION` (auto-calculated from `INFLUX_RETENTION_DAYS`).

All variables are validated at startup by the collector; errors are logged with suggested fixes.
