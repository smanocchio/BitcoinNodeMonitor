# Bitcoin Monitoring Stack configuration
# Copy this file to .env and adjust values as needed.

# --- Bitcoin Core ---
# Default to the Docker host-gateway alias so the collector container can reach a local node.
BITCOIN_RPC_HOST=host.docker.internal
# Uncomment and adjust if your node runs elsewhere (e.g., remote host, LAN IP, or Tor hostname).
#BITCOIN_RPC_HOST=192.0.2.10
BITCOIN_RPC_PORT=8332
# Uncomment to provide explicit RPC credentials instead of cookie auth
#BITCOIN_RPC_USER=
#BITCOIN_RPC_PASSWORD=
# Uncomment to point at a specific cookie file when autodetection fails
#BITCOIN_RPC_COOKIE_PATH=~/.bitcoin/.cookie   # autodetect if local
BITCOIN_NETWORK=mainnet
# Mount the node's data directory so the collector can read `bitcoin.conf` and the RPC
# cookie. Always use an absolute path because Docker Compose does not expand `~`
# automatically. Leave this blank when the collector runs on another machine and should not
# attempt local cookie discovery.
#BITCOIN_DATADIR=/home/bitcoin/.bitcoin
# Disk metrics look at the `chainstate` directory. By default this lives inside the data
# directory above, but set an explicit path if you store it elsewhere. Provide an absolute
# path that is actually mounted into the container. Set the value to an empty string to
# disable filesystem sampling entirely when the mount is unavailable.
#BITCOIN_CHAINSTATE_DIR=/home/bitcoin/.bitcoin/chainstate
ENABLE_DISK_IO=1   # Samples disk utilisation for the chainstate directory when set to 1; set to 0 to skip disk metrics entirely.

# Optional ZMQ metrics (opt-in). Set ENABLE_ZMQ=1 and ensure the endpoints match `bitcoin.conf`.
# Leave ENABLE_ZMQ=0 and the endpoints commented when you are not collecting ZMQ metrics so dashboards skip the panels.
ENABLE_ZMQ=0
#BITCOIN_ZMQ_RAWBLOCK=tcp://127.0.0.1:28332
#BITCOIN_ZMQ_RAWTX=tcp://127.0.0.1:28333

# Optional Fulcrum/Electrs (leave commented when you do not have a stats endpoint available)
# Uncomment to collect Fulcrum/Electrs statistics from a remote endpoint
#FULCRUM_STATS_URL=http://127.0.0.1:8080/stats

# --- InfluxDB ---
# Docker Compose profiles control whether the bundled InfluxDB container is started.
# Enable the `bundled-influx` profile (via `docker compose --profile bundled-influx ...` or
# `COMPOSE_PROFILES=bundled-influx,...`) to run the local service, or omit it when using an
# external instance.
INFLUX_URL=http://influxdb:8086
INFLUX_ORG=bitcoin
INFLUX_BUCKET=btc_metrics
INFLUX_RETENTION_DAYS=60
INFLUX_SETUP_USERNAME=admin
INFLUX_SETUP_PASSWORD=admin123
# Uncomment to supply an existing InfluxDB API token
#INFLUX_TOKEN=

# --- Grafana ---
# Start Grafana with the `bundled-grafana` Docker Compose profile. Leave the profile disabled
# when pointing at an existing Grafana deployment.
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=change-me
EXPOSE_UI=0   # 0=localhost only; 1=expose to LAN (see HARDENING.md)
# When setting EXPOSE_UI=1 for remote access, update the bind addresses too.
GRAFANA_BIND_IP=127.0.0.1   # Default binds to loopback; change to 0.0.0.0 or LAN IP when exposing beyond localhost.
INFLUX_BIND_IP=127.0.0.1   # Default binds to loopback; change to 0.0.0.0 or LAN IP when exposing beyond localhost.

# --- Collector Analytics ---
# Block analytics (placeholders for future dashboards)
ENABLE_BLOCK_INTERVALS=1   # Placeholder flag for additional block cadence analytics.
ENABLE_SOFTFORK_SIGNAL=1   # Placeholder flag for future softfork readiness panels.

# Peer analytics and resource usage metrics
ENABLE_PEER_QUALITY=1   # Enables peer latency aggregations.
ENABLE_PEER_CHURN=1   # Reserved for future peer churn calculations.
ENABLE_PROCESS_METRICS=1   # Collects CPU, memory, and file descriptor counts for bitcoind. Requires host PID visibility when running in a container.

# Mempool histogram source options:
#   - Leave as "none" to disable the Grafana fee histogram.
#   - Set to "core_rawmempool" to fetch the full verbose mempool on every fast scrape; this can be heavy.
#   - Set to "mempool_api" to query the configured base URL for /api/v1/fees/recommended-style JSON buckets.
MEMPOOL_HIST_SOURCE=none
# Uncomment to pull mempool data from any compatible mempool.space-style API service and ensure the stack can reach it over the network
#MEMPOOL_API_BASE=http://127.0.0.1:3006

# Collector polling
# Fast loop handles lightweight metrics that change quickly (blockchain height, mempool
# stats, ZMQ freshness). Keep this low for responsive dashboards.
SCRAPE_INTERVAL_FAST=5
# Slow loop handles heavier calls (peer summaries, process metrics, disk sampling) that do
# not need second-by-second resolution. Increase to reduce RPC and system load.
SCRAPE_INTERVAL_SLOW=30

# GeoIP enrichment
ENABLE_ASN_STATS=1   # Adds ASN enrichment when GeoIP databases are available.

# GeoIP
# Uncomment to add your MaxMind account credentials for GeoIP updates
#GEOIP_ACCOUNT_ID=
#GEOIP_LICENSE_KEY=
GEOIP_UPDATE_FREQUENCY_DAYS=7
